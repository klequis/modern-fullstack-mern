# Testing Routes

#### use dbFunctions directly
You could use the http methods in `routes/todo-route.js` for test setup and teardown, but then there would be the issue of needing to use functions for the setup that have not been tested yet as noted when starting to write tests for `routes/todo-route.js`. To avoid this, us the functions in `db/dbFunctions.js` for setup and tear down.



#### avoiding two processes
If you were to wite a test and then run `npm run test`, the test would run but the server will be started twice. When the tests complete, one of the servers will still be done and the tests will not exit. While you can end them manually ctrl+c, this will present a problem when using continious integration as the test suite will not complete.

To fix this, make a change to `server/index.js`. Wrap `app.listen` in an if statement like this:
```js
if (!module.parent) {
  app.listen(config.port, () => {
    console.log(`Events API is listening on port ${config.port}`)
  })
}
```

What this says is, if the server is launched directly, start the server. However, if the server is launched by another process, in this case Moca, don't start it. Now you will get only one instance of the server running and it will shut-down when the tests complete.

> One way to see this problem is to run `npm run test-watch`. With the `if` statement in place Nodemon will print out:
```console
[nodemon] clean exit - waiting for changes before restart
```
> Without the `if` statement, this will not be printed out.




#### decrease clutter
To decrease clutter, disable the dbFunctions tests by adding `.skip` to the outermost `describe()`:

__dbFunctions.test.js__
```js

describe.skip('dbFunctions', () => {

  ...

})

```