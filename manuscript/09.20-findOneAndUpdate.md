# Find one And Update

Add `` to `db/dbFunctions.js`

__db/dbFunctions.js__
```js
/**
 * 
 * @param {string} collection the name of a collection
 * @param {string} id a valid _id as string
 * @param {object} update document properties to be updated such as { title: 'new title', completed: true }
 * @param {boolean} returnOriginal if true, returns the original document instead of the updated one
 */
export const findOneAndUpdate = async (collection, id, update, returnOriginal = false) => {
  try {

    // if the filter has the _id prop, remove it
    const cleanedUpdate = removeIdProp(update)
    const { db } = await connectDB()
    const ret = await db.collection(collection).findOneAndUpdate(
      { _id: ObjectID(id) },
      { $set: cleanedUpdate },
      { returnOriginal: returnOriginal }
    )
    return formatReturnSuccess(ret.value)
  }
  catch (e) {
    console.warn('ERROR: dbFunctions.findOneAndUpdate', e)
    return formatReturnError(e)
  }
}
```

Add `` to exports in `db/index.js`

__db/index.js__
```js
export { 
  ...
  findOneAndDelete,
  findOneAndUpdate, // added
  insertMany,
  ...
} from './dbFunctions'

```

Add `` to imports in `dbFunctions.test.js`

__db/dbFunctions.test.js__
```js
import { 
  ...
  findOneAndDelete,
  findOneAndUpdate,
  insertMany,
  ...
} from 'db'
```

## Return Value
```js
{ lastErrorObject: { n: 1, updatedExisting: true },
  value:
   { _id: 5ce2f3b35a4b466e49cb0d3c,
     title: 'changed title',
     completed: true },
  ok: 1 }
```

## Testing `findById`
__db/dbFunctions.test.js__
```js
describe('test findOneAndUpdate', function() {
  const newData = { title: 'changed title', completed: true }
  let idToUpdate = undefined
  before(async function() {
    await dropCollection(collectionName)
    const inserted = await insertMany(collectionName, fourTodos)
    idToUpdate = inserted.data[1]._id.toString()
  })
  it('findOneAndUpdate: should return updated document', async function() {
    const updated = await findOneAndUpdate(collectionName, idToUpdate, newData)
    expect(updated.data._id.toString()).to.equal(idToUpdate)
    expect(updated.data.title).to.equal(newData.title)
    expect(updated.data.completed).to.equal(newData.completed)
  })
```



