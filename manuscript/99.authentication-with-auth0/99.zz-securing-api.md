# Securing API

## Auth0 doc: [APIs Overview](https://auth0.com/docs/apis)

- To access protected API resources an application must provide an access token, which in our case is a [JTW](https://jtw.io).

- Auth0 provides a way to define permissions (and I think roles as well)


## Working With JWTs

### Auth0 doc: [Verify Access Tokens for Custom APIs](https://auth0.com/docs/api-auth/tutorials/verify-access-token)

- uses package `express-jwt-authz`. I am using `express-jwt` instead as it is more widely used. Under the covers it uses `jsonwebtoken` which is a recommended library on [jwt.io](https://jwt.io).


# OpenID Connect v OAuth 2.0

> OpenID Connect tells you who somebody is. OAuth 2.0 tells you what somebody is allowed to do.

- OAuth 2.0 is used to grant _authorization_. It allows you to authorize one web app to access information from another web app (say a client and an API server). It does not contain any authentication (verification of user) mechanisms.

- OpenID Connect allows a user to _verify their identity_ and provide some basic profile information **without sharing credentials**.

## No Sharing of Credentials
- OpenID Connect & OAuth 2.0 operate by sharing tokens. Credentials are not shared.
- OpenID Connect issues an _identity token_.
- OAuth 2.0 issues an _access token_.




# See Also

**[Tokens used by Autho0](https://auth0.com/docs/tokens)**

- Auth0 uses two formats for tokens 
  - JSON Web Token (JWT)
  - Opaque tokens
- Auth0 uses five primary tokens
  - [ID Token](https://auth0.com/docs/tokens/id-token): Used by client applications to identify users.
  - [Access Token](https://auth0.com/docs/tokens/overview-access-tokens): Used by resource servers to authorize or deny requests.
  - [Identity Provider Access Token](https://auth0.com/docs/tokens/overview-idp-access-tokens)
  - [Refresh Token](https://auth0.com/docs/tokens/refresh_token)
  - [Management APIv2 Token](https://auth0.com/docs/api/v2/tokens)

**[Why you Should Always Use Access Tokens to Secure an API](https://auth0.com/docs/api-auth/why-use-access-tokens-to-secure-apis)**

Not sure how to really state this. Seems that client and API would not have the same client/app id and that would preclude proper verification when using the tokens for cross-purposes.

- ID Token has aud set to ClientID
- Access ID has aud set to APIs unique identifier

- Access Tokens cannot tell us if the user has authenticated. The only user information the Access Token possesses is the user ID, located in the sub claim.
- The audience of the ID Token (indicated by the aud claim) must be the client ID of the application making the authentication request.
- An API expects a token with the aud value to equal the API's unique identifier. 

**[Architecture Scenarios](https://auth0.com/docs/architecture-scenarios)**
Auth0 has 9 different architecture scenarios. We are using [SPA + API](https://auth0.com/docs/architecture-scenarios/spa-api)


# Definitions

**First-party applications:** are applications that are registered under the same Auth0 domain as the API htey are calling.
