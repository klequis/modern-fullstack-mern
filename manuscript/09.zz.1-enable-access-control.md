# Installing 4.x
-----------------

```console
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 68818C72E52529D4
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4

sudo echo "deb http://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list
echo "deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list

sudo apt-get update

sudo apt-get install -y mongodb-org

sudo systemctl start mongod
sudo systemctl enable mongod

```


## Create superuser
```console
mongo
use admin

db.createUser(
  {
    user: "superuser",
    pwd: "karl",
    roles: [ "root" ]
  }
)
```

## Enable Authenticaton

```console

ctrl+c

sudo nano /lib/systemd/system/mongod.service

```

# add --auth
ExecStart=/usr/bin/mongod --auth --config /etc/mongod.conf

ctrl+o
enter
ctrl+x

sudo systemctl daemon-reload

sudo service mongod restart


```


## Verify Authentication

```js

mongo
```

Output
```js
MongoDB shell version v4.0.10
connecting to: mongodb://127.0.0.1:27017/?gssapiServiceName=mongodb
Implicit session: session { "id" : UUID("f0f33c53-812d-4db6-b4d2-a7eb30aa7048") }
MongoDB server version: 4.0.10

```


- Try ...
```
db.getUsers()
```
... and get 'not authorized' message
```
2019-06-01T11:35:26.549-0700 E QUERY    [thread1] Error: not authorized on test to execute command { usersInfo: 1.0, $db: "test" } :
_getErrorWithCode@src/mongo/shell/utils.js:25:13
DB.prototype.getUsers@src/mongo/shell/db.js:1686:1
@(shell):1:1

```

## Create testUser

Login as superuser
```js
ctrl+c
mongo -u superuser -p --authenticationDatabase admin
```


```js
use todo-test
db.createUser(
  {
    user: "testUser",
    pwd: "karl",
    roles: [ { role: "readWrite", db: "todo-test" } ]
  }
)
```




Exit & login as testUser

```js
ctrl+c
mongo -u testUser -p --authenticationDatabase todo-test
```



## Test testUser
```js
use todo-test

db.todos.insertOne({ title: 'todo1', completed: false })
{
	"acknowledged" : true,
	"insertedId" : ObjectId("5cf316024766652dcde6f7b5")
}
```

Output
```js
 {
... "acknowledged" : true,
... "insertedId" : ObjectId("5cf316024766652dcde6f7b5")
... }
```


```js

db.todos.find()
{ "_id" : ObjectId("5cf316024766652dcde6f7b5"), "title" : "todo1", "completed" : false }

```
Output
```js
{
... "acknowledged" : true,
... "insertedId" : ObjectId("5cf316024766652dcde6f7b5")
... }
```

## Commands

```
sudo systemctl start mongodb
sudo systemctl stop mongodb
sudo systemctl restart mongodb
sudo systemctl status mongodb
sudo systemctl enable mongodb // don't start automatically
sudo systemctl disable mongodb // don't start automatically
```




## Install

> TODO: Decision: If user does setup in section 2, is this needed?

### git
```js
sudo add-apt-repository ppa:git-core/ppa 
sudo apt update
sudo apt install git
git --version
```
#### Git Config
```js
git config --global user.name "your-name"
git config --global user.email "you@email.com"
```

### node
```js
sudo apt install curl
curl -sL https://deb.nodesource.com/setup_10.x -o nodesource_setup.sh
sudo bash nodesource_setup.sh
sudo apt-get install -y nodejs
nodejs -v
```
### vscode
>TODO: is vscode needed?
https://code.visualstudio.com/
Download .deb
Open with: software install
Click Install


## Test App
1. clone app
```js
git clone https://github.com/klequis/wrapping-calls-to-mongodb.git
```
2. Open in vs code
```js
cd wrapping-calls-to-mongodb
code .
```
__index.js__
```js
return 'mongodb://localhost:27017'
```
to
```js
return 'mongodb://superuser:password@localhost:27017'
```

```js
npm i
npm run test
```
All tests should pass

