# Adding Test Coverage Reporting

> TODO: Add coverage reporting before writing any tests.
> TODO: Show coverage starting at 0 and then increasing after writing a test
> TODO: State that reader should watch coverage after each run

Code coverage reports are essential to writing complete tests. Without it, you are likely to miss a good number of lines of code.

```js
npm i -D babel-plugin-istanbul nyc
```

> TODO: Wondering if some of the below is useful for earlier sections where npm packages were added

---

- @babel/cli: is the command-line interface for babel; we use it during the build step.
- @babel/register: automatically compiles ES2015+ JavaScript as it's required in your tests.
- babel-plugin-istanbul: this plugin adds coverage instrumentation to your ES2015+ code as it's compiled.
- nyc: outputs the coverage information to disk, and handles running reports.
- cross-env: used to set NODE_ENV=test in a cross-platform compatible way.
- mocha/chai: the test framework that I happen to be using for this tutorial.

---

Add `instanbul` to `.babelrc` plugins

__babel.config.js__
```js
module.exports = function (api) {
  api.cache(true)

  const presets = ["@babel/preset-env"]
  const plugins = [
    "@babel/plugin-transform-runtime",
    "istanbul"
  ]

  return {
    presets,
    plugins
  }
}
```

Modify `package.json`

Place "nyc" below "devDependencies"

__package.json__
```json
{

  "devDependencies": {
    ...
  },
  "nyc": {
    "require": [
      "@babel/register"
    ],
    "reporter": [
      "lcov",
      "text"
    ],
    "sourceMap": false,
    "instrument": false
  }
}
```

> From doc
- nyc.require.@babel/register: indicates that we should automatically run require('@babel/register') as nyc loads our tests. This allows us to write ES2015+ code in our tests without running a build step (code is automatically compiled by babel as it is loaded).
- nyc.sourceMap=false/nyc.instrument=false: indicates that we should not use nyc for instrumenting tests with coverage or handling source-maps; this logic is instead handled by babel and babel-plugin-istanbul.
- nyc.reporter: A list of reporters that you can use, all of which come from istanbul. In this case we telling nyc to ask for an lcov which gives you a set of html reports for each file instrumented as well as an lcov.info file which can be sent to coverage services like coveralls.io or codecov.io. The text reporter gives a table summary of each file's coverage in the terminal.

Modify the `test` script in `package.json` by adding `nyc` before `mocha`
```json
"test": "NODE_ENV=test NODE_PATH=./ nyc mocha --require @babel/register",
```

> TODO: explain ignoring files, why and how