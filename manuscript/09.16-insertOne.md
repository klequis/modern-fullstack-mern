# Inserting One Document

The `insertOne` function takes a collection name and a document (object). `insertOne` performs better than `insertMany` and should be used whenever inserting one document. Of course, for our app, the number of transactions will be few and the difference will not be noticable. But the book is prep for the real world so let's do it right.

Add `insertOne` to `db/dbFunctions.js`

```js
/**
 * 
 * @param {string} collection the name of a collection
 * @param {object} data a documnet, without _id, to be inserted
 */
export const insertOne = async (collection, data) => {
  try {
    const { db } = await connectDB()
    const ret = await db.collection(collection).insertOne(data)
    return formatReturnSuccess(ret.ops[0])
  }
  catch (e) {
    return formatReturnError('insertOne', e)
  }
}
```

Add `insertOne` to exports in `db/index.js`

__db/index.js__
```js
export { 
  dropCollection,
  insertOne // added
} from './dbFunctions'
```

## Return Value

`insertOne` returns a large object of which only a small part is needed for our purposes. Here is a shortened version of the returned object. Note that `ops` is an array. It might seem best to return a document object instead of an array since there will always be just one document returned. However, the rest of our functions return an array and in my view, the inconsitancy of having this one exception would be confusing. 

```js
{
  result: { n: 1, ok: 1 },
  connection:
   Connection {
     _events: { ... }
     id: 0,
     options: { ... }
     ...
     ismaster: { ... }
  message: { ... }
  ops: [ { title: 'todo added', _id: 5ce2a7d9d1d0cc3ae9f545fc } ],
  insertedCount: 1,
  insertedId: 5ce2a7d9d1d0cc3ae9f545fc
}
```

The part that will be returned is:
```js
ops: [ { title: 'todo added', _id: 5ce2a7d9d1d0cc3ae9f545fc } ]
```

Add `insertOne` to imports in `dbFunctions.test.js`
```js
import { 
  dropCollection,
  insertOne // added
} from 'db'
```

## Testing `insertOne`

Now we can write the test

```js
describe('test insertOne', function() {
  before(async function() {
    await dropCollection(collectionName)
    await insertMany(collectionName, fourTodos)
  })
  const newData = { title: 'todo added' }
  it('insertOne: should insert new document', async function() {
    const i = await insertOne(collectionName, newData)
    expect(i.data._id).to.be.not.null
    expect(i.data.title).to.equal('todo added')
  })
})
```

Run the tests
```console
npm test
```