# Using Nginx as a Reverse Proxy

## Ref
https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-16-04

Currently todo-server can only be accessed from the server it is running on. To make todo-server accessible to the client application will will setup Nginx as a reverse proxy server.

> TODO: What is a reverse proxy

Edit the server block for api.todo-server.tk
```js
$ cd /etc/nginx/sites-available
$ sudo nano api.todo-server.tk
```

Replace the existing `location` block with the following

> CAUTION: Use spaces not tabs. Nginx will consider tabs a syntax error

```js
proxy_pass http://localhost:3030;
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection 'upgrade';
proxy_set_header Host $host;
proxy_cache_bypass $http_upgrade;
```

> TODO: what does the above do?

The complete file should look like this
```js
server {

root /var/www/api.klequis-todo.tk/html;
        index index.html index.htm index.nginx-debian.html;

        server_name api.klequis-todo.tk www.api.klequis-todo.tk;

        location / {
            proxy_pass http://localhost:3030;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_cache_bypass $http_upgrade;
        }

    listen [::]:443 ssl ipv6only=on; # managed by Certbot
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/api.klequis-todo.tk/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/api.klequis-todo.tk/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

}
server {
    if ($host = api.klequis-todo.tk) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


        listen 80;
        listen [::]:80;

        server_name api.klequis-todo.tk www.api.klequis-todo.tk;
    return 404; # managed by Certbot


}
```

Check the syntax of your edits
```js
$ sudo nginx -t
```
Output
```js
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
```

Restart Nginx
```js
$ sudo systemctl restart nginx
```

Now go to a browser and enter the address for your server
```js
https://api.klequis-todo.tk
```
The page should show
> TODO: picture 'response from todo-server'


Wow, that was a lot of work but it feels good to successfully have a server up and running. We can now focus on building out the actual server.
