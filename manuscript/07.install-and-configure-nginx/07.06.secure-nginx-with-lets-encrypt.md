# Securing Nginx with Let's Encrypt

## Ref

- https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-18-04

## Install Certbot

Add repository (Install Certbot)

```js
sudo add-apt-repository ppa:certbot/certbot
```

Install

```js
sudo apt install python-certbot-nginx
```

## Confirm Configuration

- this section inspects the serer block configuration

```js
sudo nano /etc/nginx/sites-available/api.klequis-todo.tk
```


## Allow HTTPS

Add Nginx Full

```js
sudo ufw allow 'Nginx Full'
```

Remove Ngnix HTTP

```js
sudo ufw delete allow 'Nginx HTTP'
```

> TODO: above says HTTP was removed, but the status 'Nginx Full' seems to mean all/both. Read ufw doc to confirm. old: TODO: This is currently allowing HTTP & HTTPS traffice in. Once working, try removing HTTP and allowing HTTPS only.

## Obtain an SSL Certificate (Get SSL Certificate)

NOTE: in my origin article i did not include the second '-d' that has 'www'. Don't see a need for it.

```js
sudo certbot --nginx -d api.klequis-todo.tk -d www.api.klequis-todo.tk
```

Enter your email

Choices are presented. We want all traffice redirected to HTTPS so choose #2 'Redirect'

## Test in Browser

Go back to the browser where you had api.klequis-todo.tk and refresh. You should see the URL change to https://api.klequis-todo.tk and the browsers security indicator should be positive.

## Test configuration at SSLLabs

## Test the Auto-renewal process

```js
sudo certbot renew --dry-run

```
