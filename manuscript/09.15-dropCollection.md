# Drop a Collection

The `dropCollection` function takes one parameter, a collection name. It will only be used in test and not by the client applications. 

> For `insertMany` I went through logging out the return value of the native driver function to show how it is done. For the rest of the functions, since it is repetive, I will not. However, I highly suggest you `console.log` the native driver's return value so you know what is going on.

## Add `dropCollection` to `db/dbFunctions.js`

The body of `dropCollection` is mostly like `insertMany` with one noticable exception. If you try to drop a collection that doesn't exist it will return the error `ns not found`. Since we only care that the collection doesn't exist, `dropCollection` will return `true` when a collection is not found.

When a collection is successfully dropped, `collection('collectionName').drop()` returns `true` and we will return that value.

Note success and for `ns not found` return `true`. All other errors will be returned to the caller.


__db/dbFunctions.js__
```js
/**
 *
 * @param {string} collection the name of a collection
 */
export const dropCollection = async (collection) => {
  try {
    const { db } = await connectDB()
    const ret = await db.collection(collection).drop()
    return formatReturnSuccess(ret)
  }
  catch (e) {
    if (e.message = 'ns not found') {
      return formatReturnSuccess(true)
    } else {
      return formatReturnError('insertMany', e)
    }
  }
}
```

## Export `dropCollection` in `db/index.js`

__db/index.js__
```js
export { 
  dropCollection,
  insertOne // added
} from './dbFunctions'
```

## Import `dropCollection` in `test/dbFunctions.test.js`

__test/dbFunctions.test.js__
```js
...
import { 
  close,
  dropCollection // added
  insertMany,
} from 'db'
...
```

## Test `dropCollection`

In this test we
- Add todos using `insertMany` so there is a collection to drop.
- Call `dropCollection`.
- Confirm that it returns `true`.
- Call `dropCollection` a second time. This time there will be no collection to drop and `dropCollection` should still return true.

There is one different thing we need to do here. Each test should start with a clean slate and not be dependent upon previouss tests. Before each test, we want the `todos` collection to be empty or non-existant. The test from `insertMany` left 4 documents in the `todos` collection and need to be removed. The best tool we have for that is `dropCollection`. That means `dropCollection` will be used before it is tested.

Test preperation will be done in a `before` hook. For this test, the preparation needed is to drop the `todos` collection and then insert 4 fresh documents.

```js
describe('dbFunctions', function() {
  ... 

  describe('test dropCollection', function() {
    // In the event the collection to drop is not found, dropCollection()
    // will return { data: true, error: null }
    it('should return true', async function() {
      await insertMany(collectionName, fourTodos)
      const dc1 = await dropCollection(collectionName)
      expect(dc1.data).to.equal(true)
      const dc2 = await dropCollection(collectionName)
      expect(dc2.data).to.equal(true)
    })
  })
})  
```

Run the tests
```console
npm test
```