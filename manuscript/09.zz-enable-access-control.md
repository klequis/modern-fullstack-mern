Mongo Shell approach


**check if mongod is running**
```js
ps -e| grep 'mongod'
```

**list users**
```js
use admin
db.getUsers()
```

**drop a user**
```js
db.dropUser('username')
```

**mongo status**
```js
sudo systemctl status mongod
```

**create root user**
```js
db.createUser(
  {
    user: "superuser",
    pwd: "changeMeToAStrongPassword",
    roles: [ "root" ]
  }
)
```





```js
mongo
use admin
db.createUser(
  {
    user: 'localadmin',
    pwd: 'password',
    roles: [ { role: 'userAdminAnyDatabase', db: 'admin' }, 'readWriteAnyDatabase' ]
  }
)
ctrl+c
sudo service mongod restart
```



#### Nope
```
ctrl+d

open /etc/mongod.conf

security:
  authorization: 'enabled'

```js
sudo service mongodb restart
```

- use a password generator


# [Enable Access Control](https://docs.mongodb.com/manual/tutorial/enable-authentication/)

> Think I should give the [userAdminAnyDatabase](https://docs.mongodb.com/manual/reference/built-in-roles/#userAdminAnyDatabase) role to the first user but go by the enable access control doc.

- [database user role](https://docs.mongodb.com/manual/reference/built-in-roles/#database-user-roles)
- [database administration role](https://docs.mongodb.com/manual/reference/built-in-roles/#database-administration-roles)

## Definitions


- **Resource:** A resource can be a database, collection, set of collections or a cluster.

- **Privileges:** A privilege consists of a specified resource and the actions permitted on it.

- **Action:** An action specifies the operation allowed on the resource. For example 'find', 'create' or 'insert'.

- **Role:** A role grants privileges to perform specific actions on a resource. A role can contain one or more privilege. It can also contain other roles, in which case granting the role to a user applies the privileges in the contained role. 
  - **[Built-In Roles](https://docs.mongodb.com/manual/reference/built-in-roles/):** Built-in roles are roles that come with MongoDB by default. A complete list of built-in roles can be found at .
  - [**User-Defined roles](https://docs.mongodb.com/manual/core/security-user-defined-roles/):** User-defined roles are roles that are created by a MongoDB user. You use them to customize privileges according to your needs.

## [Role-Based Access Control](https://docs.mongodb.com/manual/core/authorization/#role-based-access-control)

Initially after installation, access control is not enabled. Once you enable it users must authenticate themselves.

## [Authentication Database](https://docs.mongodb.com/manual/core/security-users/#user-authentication-database)

- So you create a given user in a given database and that becomes the authentication for the user. However, a user's privileges are not limited to that database. You can assign it roles in other databases as well.


## [Certificate Authority](https://docs.mongodb.com/manual/core/security-x.509/#certificate-authority)

> For production use, your MongoDB deployment should use valid certificates generated and signed by a single certificate authority. You or your organization can generate and maintain an independent certificate authority, or use certificates generated by a third-party TLS/SSL vendor. Obtaining and managing certificates is beyond the scope of this documentation.



## Illustrative Info
- You can see users in roles using Robo3T. Roles are in system.roles and users in system.users


---

- [Database Commands](https://docs.mongodb.com/manual/reference/command/)
  - [Role Management Commands](https://docs.mongodb.com/manual/reference/command/nav-role-management/)
  - [createUser](https://docs.mongodb.com/manual/reference/command/#user-management-commands)



---
### Connect with authentication


https://mongodb.github.io/node-mongodb-native/2.0/tutorials/connecting/

var MongoClient = require('mongodb').MongoClient
  , assert = require('assert');

// Connection URL
var url = 'mongodb://dave:password@localhost:27017/myproject';
// Use connect method to connect to the Server
MongoClient.connect(url, function(err, db) {
  assert.equal(null, err);
  console.log('Connected correctly to server');

  db.close();
});


---
## Admin addUser()

https://mongodb.github.io/node-mongodb-native/2.0/api/Admin.html#addUser

> Don't use this one

---

## Db addUser()

https://mongodb.github.io/node-mongodb-native/2.0/api/Db.html#addUser


```js
import mongodb, { ObjectID } from 'mongodb'

const MongoClient = mongodb.MongoClient

let client

const connectDB = async () => {
  if (!client) {
    client = await MongoClient.connect(config.mongoUrl, {
      useNewUrlParser: true
    })
  }
  return { db: client.db(config.dbName) }
}


const close = async () => {
  if (client) {
    client.close()
  }
  client = undefined
}

const createUser = async () => {
  try {
    const { db } = await connectDB()
    const opts = {
      roles: [
        'find',
        'insert',
        'remove',
        'update',
      ]
    }
    const user = await db.addUser('testUser', 'password@1', opts)
    await db.close()
  }
  catch (e) {
    console.log('createUser:', e)
  }
}

```

var MongoClient = require('mongodb').MongoClient,
  test = require('assert');
MongoClient.connect('mongodb://localhost:27017/test', function(err, db) {
  // Add a user to the database
  db.addUser('user', 'name').then(function(result) {

    // Remove the user from the db
    db.removeUser('user').then(function(result) {
      db.close();
    });
  });
})